var j=jQuery.noConflict();var params=new Object();j(document).ready(function(){j("#previewbutton").click(function(){doCarouselPreview()});j("#okbutton").click(function(){insertResultTag()});j("#bicm-carousel-search-param").bind("keypress",function(A){if(A.keyCode==13){doCarouselPreview()}})});function getParameters(){searchsize=j("#bicm-carousel-search-param input[name='size']").val();if(searchsize!=""&&!isNaN(searchsize)&&searchsize>0){params.size=searchsize}else{params.size=20;j("#bicm-carousel-search-param input[name='size']").val("20")}searchtitle=j("#bicm-carousel-search-param input[name='title']").val();if(searchtitle!=""){params.title=searchtitle}searchauthor=j("#bicm-carousel-search-param input[name='author']").val();if(searchauthor!=""){params.author=searchauthor}searchpublisher=j("#bicm-carousel-search-param select[name='publisher'] option:selected").text();if(j("#bicm-carousel-search-param select[name='publisher'] option:selected").val()!=""){params.publisher=searchpublisher}widgetwidth=j("#bicm-carousel-search-param input[name='widget-width']").val();if(widgetwidth!=""&&!isNaN(widgetwidth)&&widgetwidth>0){params["widget-width"]=widgetwidth}else{params["widget-width"]=760;j("#bicm-carousel-search-param input[name='widget-width']").val("760")}widgetheight=j("#bicm-carousel-search-param input[name='widget-height']").val();if(widgetheight!=""&&!isNaN(widgetheight)&&widgetheight>0){params["widget-height"]=widgetheight}else{params["widget-height"]=300;j("#bicm-carousel-search-param input[name='widget-height']").val("300")}widgetbgcolor=j("#bicm-carousel-search-param input[name='widget-bgcolor']").val();if(widgetbgcolor!=""){params["widget-bgcolor"]=widgetbgcolor}widgetcoverwidth=j("#bicm-carousel-search-param input[name='widget-cover-width']").val();if(widgetcoverwidth!=""&&!isNaN(widgetcoverwidth)&&widgetcoverwidth>0){params["widget-cover-width"]=widgetcoverwidth}else{params["widget-cover-width"]=170;j("#bicm-carousel-search-param input[name='widget-cover-width']").val("170")}searchisbns=j("#bicm-carousel-search-param textarea[name='isbns']").val();if(searchisbns!=""){var B=/\D/g;var F=searchisbns.split(",");var E=new Array();for(var D=0;D<F.length;D++){var C=F[D].replace(B,"");if(C!=""){E.push(C)}C=""}var A="";for(var D=0;D<E.length;D++){A+=E[D]+","}A=removeTrailingComma(A);j("#bicm-carousel-search-param textarea[name='isbns']").val(A);params.isbns=A}}function doCarouselPreview(){params=new Object();getParameters();var A="";A=buildParameterString();j("#carouselpreview iframe").attr("src","bicm-carousel-preview.php?param="+encodeURIComponent(A))}function buildParameterString(){var A="";A="{ ";if(params.isbns!=""&&params.isbns!==undefined){A+="'isbns':'"+params.isbns+"',"}if(params.size!=""&&params.size!==undefined){A+="'size':"+params.size+","}if(params.title!=""&&params.title!==undefined){A+="'title':'"+params.title+"',"}if(params.author!=""&&params.author!==undefined){A+="'author':'"+params.author+"',"}if(params.publisher!=""&&params.publisher!==undefined){A+="'publisher':'"+params.publisher+"',"}if(params["widget-height"]!=""&&params["widget-height"]!==undefined){A+="'height':"+params["widget-height"]+","}if(params["widget-width"]!=""&&params["widget-width"]!==undefined){A+="'width':"+params["widget-width"]+","}if(params["widget-cover-width"]!=""&&params["widget-cover-width"]!==undefined){A+="'coverWidth':"+params["widget-cover-width"]+","}if(params["widget-bgcolor"]!=""&&params["widget-bgcolor"]!==undefined){if(params["widget-bgcolor"].substring(0,1)!="#"){A+="'bgcolor':'#"+params["widget-bgcolor"]+"',";j("#bicm-carousel-search-param input[name='widget-bgcolor']").val("#"+params["widget-bgcolor"])}else{A+="'bgcolor':'"+params["widget-bgcolor"]+"',"}}A=removeTrailingComma(A);A+=" }";return A}function removeTrailingComma(B){if(B.substring((B.length-1),B.length)==","){var A=B.substr(0,(B.length-1));B=A}return B}function insertResultTag(B){var C="";var A="";C=buildParameterString();A='[bic-carousel param="'+C+'"]';send_to_editor(A)}function send_to_editor(A){parent.send_to_editor(A);parent.tb_remove()};