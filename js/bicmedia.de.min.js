var j=jQuery.noConflict();j(document).ready(function(){j("#searchbutton").click(function(){doBICMSearch()});j("#result > ul").tabs();j.tablesorter.defaults.widgets=["zebra"];j.tablesorter.defaults.headers={3:{sorter:false}};j("#bookresults").tablesorter();j("#audioresults").tablesorter();j("#bicm-search").bind("keypress",function(A){if(A.keyCode==13){doBICMSearch()}})});function doBICMSearch(){resetTables();var E=new Object();var C=j("#bicm-search input[type='checkbox']:checked");var D=new Array();var B=j("#bicm-search [type='checkbox']:not(:checked)");var F=new Array();j(C).each(function(G,H){E[H.name]="true"});j(B).each(function(G,H){E[H.name]="false"});searchsize=j("#bicm-search input[name='size']").val();if(searchsize!=""&&!isNaN(searchsize)){E.size=searchsize}searchtitle=j("#bicm-search input[name='title']").val();if(searchtitle!=""){E.title=searchtitle}searchauthor=j("#bicm-search input[name='author']").val();if(searchauthor!=""){E.author=searchauthor}searchpublisher=j("#bicm-search select[name='publisher'] option:selected").text();if(j("#bicm-search select[name='publisher'] option:selected").val()!=""){E.publisher=searchpublisher}searchisbn=j("#bicm-search input[name='isbn']").val();if(searchisbn!=""){var A=/\D/g;filteredisbn=searchisbn.replace(A,"");j("#bicm-search input[name='isbn']").val(filteredisbn);E.isbn=filteredisbn}if((E.isbn==""||E.isbn==undefined)&&((j("#bicm-search select[name='publisher'] option:selected").val()==""||j("#bicm-search select[name='publisher'] option:selected").val()==undefined)&&(E.author==""||E.author==undefined)&&(E.title==""||E.title==undefined))){j("#message").html("Geben Sie f&uuml;r die Suche mindestens eine ISBN Nummer oder einen Titel, Autor oder Verlag an.");return false}if(E.isbn==""||E.isbn==undefined){doAJAXSearchRequest(E)}else{doAJAXISDNSearchRequest(E)}}function doAJAXSearchRequest(A){j("#message").html("Suche wird ausgef&uuml;hrt");j.ajax({type:"GET",url:"bicmediaproxy.php",processData:true,data:A,success:parseResult,error:function(D,B,C){alert("Error: "+B)},dataType:"xml"})}function doAJAXISDNSearchRequest(A){j("#message").html("Suche wird ausgef&uuml;hrt");j.ajax({type:"GET",url:"bicmediaproxy.php",processData:true,data:A,success:parseResultISBN,error:function(D,B,C){alert("Error: "+B)},dataType:"xml"})}function parseResult(A,B){fehler=j(A).find("error").text();if(fehler.length!=0){j("#message").html("<b style='color:red'>Ein Fehler ist aufgetreten <br />"+fehler+"</b>");return false}else{if(j(A).find("book").length==0&&j(A).find("audio").length==0){j("#message").html("Keine Ergebnisse gefunden");return false}else{j("#message").html("Suche erfolgreich");j("book",A).each(function(C,D){fillTable("book",D)});j(A).find("audio").each(function(C,D){fillTable("audio",D)});if(j(A).find("book").length!=0){updateTableSorting("#bookresults")}if(j(A).find("audio").length!=0){updateTableSorting("#audioresults")}return false}}}function parseResultISBN(E,H){fehler=j(E).find("error").text();if(fehler.length!=0){j("#message").html("<b style='color:red'>Ein Fehler ist aufgetreten <br />"+fehler+"</b>");return false}else{j("#message").html("Suche erfolgreich");var F=j(E).find("media");var B=j(F).attr("type");var D=j(F).attr("artist");var A=j(F).attr("isbn");var G=j(F).attr("title");var C=j("<a></a>").html("&Uuml;bernehmen").click(function(){insertResultTag(A)}).css("cursor","pointer");fillTableRow(B,G,D,A,C);if(B=="book"){updateTableSorting("#bookresults")}if(B=="audio"){updateTableSorting("#audioresults")}return false}}function updateTableSorting(B){var A=[[0,0]];j(B).trigger("update");j(B).trigger("sorton",[A])}function fillTable(E,D){var F=j(D).attr("title");var C=j(D).attr("author");var A=j(D).attr("isbn");var B=j("<a></a>").html("Auswahl").click(function(){insertResultTag(A)}).css("cursor","pointer");fillTableRow(E,F,C,A,B)}function fillTableRow(E,F,C,A,B){if(C===undefined){C=" "}if(F===undefined){F=" "}var D=j("<tr></tr>");j(D).append(j("<td></td>").html(F));j(D).append(j("<td></td>").html(C));j(D).append(j("<td></td>").html(A));j(D).append(j("<td></td>").html(B));j("#"+E+"results tbody").append(D)}function insertResultTag(B){var D=new Object();widgetwidth=j("#bicm-search-param input[name='widget-width']").val();if(widgetwidth!=""&&!isNaN(widgetwidth)){D["widget-width"]=widgetwidth}else{D["widget-width"]=200}widgetheight=j("#bicm-search-param input[name='widget-height']").val();if(widgetheight!=""&&!isNaN(widgetheight)){D["widget-height"]=widgetheight}else{D["widget-height"]=400}widgetbuyurl=j("#bicm-search-param > input[name='widget-buyurl']").val();if(widgetbuyurl!=""){D["widget-buyurl"]=widgetbuyurl}var C="";if(D["widget-width"]!=200||D["widget-height"]!=400){C="width="+D["widget-width"]+",height="+D["widget-height"]}if(D["widget-buyurl"]!=""&&D["widget-buyurl"]!=undefined){if(C!=""){C=C+","}C=C+"buyUrl="+D["widget-buyurl"]}var A="";if(C!=""){A='[bic-media isbn="'+B+'" param="'+C+'"]'}else{A='[bic-media isbn="'+B+'"]'}send_to_editor(A)}function resetTables(){j("#bookresults tr:not(:first)").remove();j("#audioresults tr:not(:first)").remove()}function send_to_editor(A){parent.send_to_editor(A);parent.tb_remove()};